{% extends 'base.html' %}
{% load static %}

{% block title %}{{ course.title }} - Course Details{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'course_app:courses_list' %}">Courses</a></li>
            <li class="breadcrumb-item active" aria-current="page">{{ course.title|truncatewords:4 }}</li>
        </ol>
    </nav>

    <!-- Course Header Section -->
    <div class="row">
        <div class="col-12">
            <div class="card shadow-sm mb-4">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h1 class="h2 mb-2 text-primary">{{ course.title }}</h1>
                            <p class="text-muted mb-3">{{ course.short_description }}</p>
                            <div class="d-flex flex-wrap gap-2 align-items-center">
                                <span class="badge bg-{% if course.status %}success{% else %}danger{% endif %}">
                                    <i class="fas fa-circle me-1"></i>
                                    {% if course.status %}Active{% else %}Inactive{% endif %}
                                </span>
                                <span class="badge bg-info">
                                    <i class="fas fa-clock me-1"></i>
                                    {{ course.duration_display }}
                                </span>
                                <span class="badge bg-secondary">
                                    <i class="fas fa-user me-1"></i>
                                    {{ course.author.get_full_name|default:course.author.username }}
                                </span>
                                <span class="badge bg-light text-dark border">
                                    <i class="fas fa-calendar me-1"></i>
                                    Created: {{ course.created_at|date:"M d, Y" }}
                                </span>
                            </div>
                        </div>
                        <div class="col-md-4 text-md-end">
                            <div class="price-section">
                                {% if course.has_discount %}
                                <div class="d-flex align-items-center justify-content-md-end gap-2">
                                    <span class="h3 text-success mb-0">₹{{ course.offer_price }}</span>
                                    <span class="text-muted text-decoration-line-through">₹{{ course.price }}</span>
                                    <span class="badge bg-danger">Save {{ course.discount_percentage }}%</span>
                                </div>
                                {% else %}
                                <span class="h3 text-dark mb-0">₹{{ course.price }}</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="row">
        <!-- Left Column - Course Image & Media -->
        <div class="col-lg-4 col-md-5 mb-4">
            <!-- Course Image -->
            <div class="card shadow-sm mb-4">
                <div class="card-body p-0">
                    {% if course.image %}
                    <img src="{{ course.image.url }}" 
                         alt="{{ course.title }}" 
                         class="img-fluid rounded-top w-100"
                         style="height: 250px; object-fit: cover;">
                    {% else %}
                    <div class="bg-light d-flex align-items-center justify-content-center rounded-top" 
                         style="height: 250px;">
                        <i class="fas fa-book fa-3x text-muted"></i>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Course Stats -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-transparent">
                    <h5 class="mb-0"><i class="fas fa-chart-bar me-2"></i>Course Statistics</h5>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-6 mb-3">
                            <div class="border-end">
                                <h4 class="text-primary mb-1">{{ active_media_count }}</h4>
                                <small class="text-muted">Media Files</small>
                            </div>
                        </div>
                        <div class="col-6 mb-3">
                            <div>
                                <h4 class="text-success mb-1">{{ course.enrollments.count }}</h4>
                                <small class="text-muted">Enrollments</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="card shadow-sm">
                <div class="card-header bg-transparent">
                    <h5 class="mb-0"><i class="fas fa-bolt me-2"></i>Quick Actions</h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="{% url 'course_app:course_edit' course.pk %}" 
                           class="btn btn-warning btn-sm">
                            <i class="fas fa-edit me-1"></i>Edit Course
                        </a>
                        <a href="{% url 'course_app:course_media_list' course.pk %}" 
                           class="btn btn-info btn-sm">
                            <i class="fas fa-photo-video me-1"></i>Manage Media
                        </a>
                        <a href="{% url 'course_app:course_delete' course.pk %}" 
                           class="btn btn-danger btn-sm"
                           onclick="return confirm('Are you sure you want to delete this course?')">
                            <i class="fas fa-trash me-1"></i>Delete Course
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column - Course Details -->
        <div class="col-lg-8 col-md-7">
            <!-- Course Description -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-transparent">
                    <h5 class="mb-0"><i class="fas fa-file-alt me-2"></i>Course Description</h5>
                </div>
                <div class="card-body">
                    <div class="course-description">
                        {{ course.description | safe | linebreaks }}
                    </div>
                </div>
            </div>

            <!-- Course Details -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-transparent">
                    <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>Course Details</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <table class="table table-borderless">
                                <tbody>
                                    <tr>
                                        <td class="text-muted" width="40%"><i class="fas fa-tag me-2"></i>Title:</td>
                                        <td><strong>{{ course.title }}</strong></td>
                                    </tr>
                                    <tr>
                                        <td class="text-muted"><i class="fas fa-clock me-2"></i>Duration:</td>
                                        <td><strong>{{ course.duration_display }}</strong></td>
                                    </tr>
                                    <tr>
                                        <td class="text-muted"><i class="fas fa-user me-2"></i>Author:</td>
                                        <td><strong>{{ course.author.get_full_name|default:course.author.username }}</strong></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <table class="table table-borderless">
                                <tbody>
                                    <tr>
                                        <td class="text-muted" width="40%"><i class="fas fa-indian-rupee-sign me-2"></i>Price:</td>
                                        <td>
                                            <strong class="{% if course.has_discount %}text-success{% endif %}">
                                                ₹{{ course.get_actual_price }}
                                            </strong>
                                            {% if course.has_discount %}
                                            <small class="text-muted text-decoration-line-through ms-2">₹{{ course.price }}</small>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="text-muted"><i class="fas fa-calendar me-2"></i>Created:</td>
                                        <td><strong>{{ course.created_at|date:"M d, Y" }}</strong></td>
                                    </tr>
                                    <tr>
                                        <td class="text-muted"><i class="fas fa-sync me-2"></i>Updated:</td>
                                        <td><strong>{{ course.updated_at|date:"M d, Y" }}</strong></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Enrollment Section -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-transparent d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="fas fa-users me-2"></i>Course Enrollments</h5>
                    <span class="badge bg-primary" id="total-enrollments">{{ course.enrollments.count }} Total</span>
                </div>
                <div class="card-body">
                    <!-- DataTable -->
                    <div class="table-responsive">
                        <table id="enrollments-table" class="table table-hover table-striped table-bordered w-100">
                            <thead class="table-primary">
                                <tr>
                                    <th class="text-center">Student</th>
                                    <th class="text-center">Contact</th>
                                    <th class="text-center">Education</th>
                                    <th class="text-center">Experience</th>
                                    <th class="text-center">Source</th>
                                    <th class="text-center">Enrolled Date</th>
                                    <th class="text-center">Status</th>
                                    <th class="text-center">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data will be loaded via AJAX -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Enrollment Details Modal -->
<div class="modal fade" id="enrollmentModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Enrollment Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="enrollmentDetails">
                <!-- Details will be loaded here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Enrollment Confirmation Modal -->
<div class="modal fade" id="deleteEnrollmentModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Delete Enrollment</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this enrollment?</p>
                <p class="text-muted small">This action cannot be undone.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteEnrollment">Delete</button>
            </div>
        </div>
    </div>
</div>

<!-- Toast Container -->
<div id="toastContainer" class="toast-container position-fixed top-0 end-0 p-3"></div>
{% endblock %}

{% block extra_css %}
<!-- DataTables CSS -->
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css">
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/2.3.6/css/buttons.bootstrap5.min.css">
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/2.4.1/css/responsive.bootstrap5.min.css">

<style>
.course-description {
    line-height: 1.6;
    font-size: 1rem;
}

.card {
    border: none;
    border-radius: 12px;
}

.card-header {
    border-bottom: 1px solid #e3e6f0;
    padding: 1rem 1.25rem;
}

.breadcrumb {
    background: transparent;
    padding: 0;
    margin-bottom: 1.5rem;
}

.breadcrumb-item a {
    text-decoration: none;
    color: #6c757d;
}

.breadcrumb-item.active {
    color: #495057;
}

.price-section .h3 {
    font-weight: 700;
}

.table-borderless td {
    padding: 0.5rem 0.25rem;
}

@media (max-width: 768px) {
    .container-fluid {
        padding-left: 15px;
        padding-right: 15px;
    }
    
    .card-body {
        padding: 1rem;
    }
    
    .h2 {
        font-size: 1.5rem;
    }
    
    .price-section .h3 {
        font-size: 1.5rem;
    }
}

/* Hover effects */
.card:hover {
    transform: translateY(-2px);
    transition: all 0.3s ease;
}

.btn:hover {
    transform: translateY(-1px);
    transition: all 0.2s ease;
}

/* Enrollment DataTable Styles */
#enrollments-table {
    border: 1px solid #dee2e6;
    border-collapse: separate !important;
}

#enrollments-table th,
#enrollments-table td {
    vertical-align: middle;
    padding: 8px 12px;
}

#enrollments-table thead th {
    background-color: #e3f2fd;
    font-weight: 600;
    font-size: 0.85rem;
}

.enrollment-actions {
    min-width: 120px;
}

/* Toast styling */
.toast {
    background-color: rgba(255, 255, 255, 0.95);
    border-left: 4px solid;
}

.toast-success {
    border-left-color: #28a745;
}

.toast-error {
    border-left-color: #dc3545;
}

.toast-info {
    border-left-color: #17a2b8;
}

/* Responsive adjustments for enrollment table */
@media (max-width: 768px) {
    #enrollments-table {
        font-size: 0.8rem;
    }
    
    #enrollments-table th,
    #enrollments-table td {
        padding: 6px 8px;
    }
    
    .dt-buttons .btn {
        margin-bottom: 5px;
        font-size: 0.8rem;
    }
}
</style>
{% endblock %}

{% block extra_js %}
<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<!-- DataTables JS -->
<script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.3.6/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.bootstrap5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.print.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.4.1/js/dataTables.responsive.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>

<script>
// CSRF token function for Django
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// Toast notification function
function showToast(message, type = 'info') {
    const toastId = 'toast-' + Date.now();
    const toastHtml = `
        <div id="${toastId}" class="toast" role="alert">
            <div class="toast-header">
                <strong class="me-auto">Notification</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body">
                ${message}
            </div>
        </div>
    `;
    
    $('#toastContainer').append(toastHtml);
    const toastElement = document.getElementById(toastId);
    const toast = new bootstrap.Toast(toastElement);
    
    // Add background color based on type
    if (type === 'success') {
        $(toastElement).addClass('toast-success');
    } else if (type === 'error') {
        $(toastElement).addClass('toast-error');
    } else {
        $(toastElement).addClass('toast-info');
    }
    
    toast.show();
    
    // Remove toast from DOM after it's hidden
    toastElement.addEventListener('hidden.bs.toast', function() {
        $(this).remove();
    });
}

// Enrollment DataTable Initialization
function initializeEnrollmentDataTable() {
    var enrollmentTable = $('#enrollments-table').DataTable({
        "processing": true,
        "serverSide": true,
        "ajax": {
            "url": "{% url 'course_app:course_enroll_datatable' course.pk %}",
            "type": "GET",
            "dataType": "json",
            "data": function(d) {
                // Add any additional parameters if needed
            },
            "dataSrc": function(json) {
                // Update total enrollments count
                if (json.recordsTotal !== undefined) {
                    $('#total-enrollments').text(json.recordsTotal + ' Total');
                }
                
                return json.data;
            },
            "error": function(xhr, error, code) {
                console.log('Enrollment AJAX Error:', xhr, error, code);
                showToast('Error loading enrollments. Please try again.', 'error');
            }
        },
        "columns": [
            {
                "data": "student",
                "name": "first_name",
                "className": "text-center",
                "orderable": true,
                "render": function(data, type, row) {
                    if (type === 'sort' || type === 'type' || type === 'export') {
                        // Extract text from HTML for export
                        var tempDiv = $('<div>').html(data);
                        return tempDiv.text() || data;
                    }
                    return data;
                }
            },
            {
                "data": "contact",
                "name": "contact_number",
                "className": "text-center",
                "orderable": true,
                "render": function(data, type, row) {
                    if (type === 'sort' || type === 'type' || type === 'export') {
                        var tempDiv = $('<div>').html(data);
                        return tempDiv.text() || data;
                    }
                    return data;
                }
            },
            {
                "data": "education",
                "name": "education",
                "className": "text-center",
                "orderable": true,
                "render": function(data, type, row) {
                    if (type === 'sort' || type === 'type' || type === 'export') {
                        var tempDiv = $('<div>').html(data);
                        return tempDiv.text() || data;
                    }
                    return data;
                }
            },
            {
                "data": "experience",
                "name": "experience",
                "className": "text-center",
                "orderable": true,
                "render": function(data, type, row) {
                    if (type === 'sort' || type === 'type' || type === 'export') {
                        var tempDiv = $('<div>').html(data);
                        return tempDiv.text() || data;
                    }
                    return data;
                }
            },
            {
                "data": "source",
                "name": "source",
                "className": "text-center",
                "orderable": true,
                "render": function(data, type, row) {
                    if (type === 'sort' || type === 'type' || type === 'export') {
                        var tempDiv = $('<div>').html(data);
                        return tempDiv.text() || data;
                    }
                    return data;
                }
            },
            {
                "data": "enrolled_at",
                "name": "enrolled_at",
                "className": "text-center",
                "orderable": true,
                "render": function(data, type, row) {
                    if (type === 'sort' || type === 'type' || type === 'export') {
                        var tempDiv = $('<div>').html(data);
                        return tempDiv.text() || data;
                    }
                    return data;
                }
            },
            {
                "data": "status",
                "name": "status",
                "className": "text-center",
                "orderable": true,
                "render": function(data, type, row) {
                    if (type === 'sort' || type === 'type' || type === 'export') {
                        var tempDiv = $('<div>').html(data);
                        return tempDiv.text() || data;
                    }
                    return data;
                }
            },
            {
                "data": "actions",
                "name": "actions",
                "className": "text-center enrollment-actions",
                "orderable": false,
                "searchable": false,
                "render": function(data, type, row) {
                    // For export, don't include action buttons
                    if (type === 'export') {
                        return '';
                    }
                    return data;
                }
            }
        ],
        "order": [[5, 'desc']], // Default sort by enrolled date (newest first)
        "pageLength": 10,
        "responsive": true,
        "dom": '<"row"<"col-sm-12 col-md-6"B><"col-sm-12 col-md-6"f>><"row"<"col-sm-12"tr>><"row"<"col-sm-12 col-md-5"i><"col-sm-12 col-md-7"p>>',
        "buttons": [
            {
                extend: 'copy',
                text: '<i class="fas fa-copy"></i> Copy',
                className: 'btn btn-secondary btn-sm',
                exportOptions: {
                    columns: [0, 1, 2, 3, 4, 5, 6], // Exclude actions column
                    format: {
                        body: function(data, row, column, node) {
                            // Strip HTML for copy export
                            return $(data).text() || data;
                        }
                    }
                }
            },
            {
                extend: 'excel',
                text: '<i class="fas fa-file-excel"></i> Excel',
                className: 'btn btn-success btn-sm',
                exportOptions: {
                    columns: [0, 1, 2, 3, 4, 5, 6], // Exclude actions column
                    format: {
                        body: function(data, row, column, node) {
                            return $(data).text() || data;
                        }
                    }
                },
                filename: function() {
                    var courseTitle = '{{ course.title|slugify }}' || 'course';
                    return 'enrollments_' + courseTitle + '_' + new Date().toISOString().slice(0, 10);
                }
            },
            {
                extend: 'pdf',
                text: '<i class="fas fa-file-pdf"></i> PDF',
                className: 'btn btn-danger btn-sm',
                exportOptions: {
                    columns: [0, 1, 2, 3, 4, 5, 6], // Exclude actions column
                    format: {
                        body: function(data, row, column, node) {
                            return $(data).text() || data;
                        }
                    }
                },
                customize: function(doc) {
                    doc.defaultStyle.fontSize = 9;
                    doc.styles.tableHeader.fontSize = 10;
                    doc.styles.tableHeader.fillColor = '#e3f2fd';
                    doc.pageMargins = [10, 10, 10, 10];
                    doc.content[1].table.widths = ['*', '*', '*', '*', '*', '*', '*'];
                    doc.content[0].text = 'Enrollments - {{ course.title }} - ' + new Date().toLocaleDateString();
                    doc.content[0].alignment = 'center';
                    doc.content[0].margin = [0, 0, 0, 10];
                },
                filename: function() {
                    var courseTitle = '{{ course.title|slugify }}' || 'course';
                    return 'enrollments_' + courseTitle + '_' + new Date().toISOString().slice(0, 10);
                }
            },
            {
                extend: 'print',
                text: '<i class="fas fa-print"></i> Print',
                className: 'btn btn-info btn-sm',
                exportOptions: {
                    columns: [0, 1, 2, 3, 4, 5, 6], // Exclude actions column
                    format: {
                        body: function(data, row, column, node) {
                            return $(data).text() || data;
                        }
                    }
                },
                customize: function(win) {
                    $(win.document.body).find('table').addClass('display').css('font-size', '10px');
                    $(win.document.body).find('tr:nth-child(odd) td').each(function(index){
                        $(this).css('background-color','#f8f9fa');
                    });
                    $(win.document.body).find('h1').css('text-align','center').text('Enrollments - {{ course.title }}');
                    $(win.document.body).find('.dt-buttons, .dataTables_filter, .dataTables_length, .dataTables_info, .dataTables_paginate').remove();
                }
            }
        ],
        "language": {
            "search": "Search:",
            "lengthMenu": "Show _MENU_ entries",
            "info": "Showing _START_ to _END_ of _TOTAL_ enrollments",
            "infoEmpty": "Showing 0 to 0 of 0 enrollments",
            "infoFiltered": "(filtered from _MAX_ total enrollments)",
            "zeroRecords": "No matching enrollments found",
            "paginate": {
                "first": "First",
                "last": "Last",
                "next": "Next",
                "previous": "Previous"
            }
        },
        "initComplete": function() {
            // Add custom CSS to search box
            $('.dataTables_filter input').addClass('form-control form-control-sm')
                .attr('placeholder', 'Search by name, email, or contact...')
                .css('width', '300px');
        }
    });

    // Initialize tooltips when table is drawn
    enrollmentTable.on('draw', function() {
        $('[data-bs-toggle="tooltip"]').tooltip();
        
        // Attach click handlers for view enrollment buttons
        $('.view-enrollment').on('click', function(e) {
            e.preventDefault();
            var enrollmentId = $(this).data('enrollment-id');
            viewEnrollmentDetails(enrollmentId);
        });
        
        // Attach click handlers for edit enrollment buttons
        $('.edit-enrollment').on('click', function(e) {
            e.preventDefault();
            var enrollmentId = $(this).data('enrollment-id');
            editEnrollment(enrollmentId);
        });
        
        // Attach click handlers for delete enrollment buttons
        $('.delete-enrollment').on('click', function(e) {
            e.preventDefault();
            var enrollmentId = $(this).data('enrollment-id');
            var studentName = $(this).closest('tr').find('td:first-child strong').text().trim();
            confirmDeleteEnrollment(enrollmentId, studentName);
        });
    });

    // Handle DataTable errors
    enrollmentTable.on('error.dt', function(e, settings, techNote, message) {
        console.log('DataTable Error:', message);
    });

    // Custom styling for buttons
    $('.dt-buttons').addClass('btn-group');
    $('.dt-button').addClass('btn btn-sm');
}

// View enrollment details
function viewEnrollmentDetails(enrollmentId) {
    // Show loading in modal
    $('#enrollmentDetails').html(`
        <div class="text-center py-4">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">Loading enrollment details...</p>
        </div>
    `);
    
    var enrollmentModal = new bootstrap.Modal(document.getElementById('enrollmentModal'));
    enrollmentModal.show();
    
    // For now, show a simple message since we don't have the details endpoint
    setTimeout(function() {
        $('#enrollmentDetails').html(`
            <div class="alert alert-info">
                <i class="fas fa-info-circle me-2"></i>
                Enrollment details view is not implemented yet.
            </div>
        `);
    }, 1000);
}

// Edit enrollment (placeholder function)
function editEnrollment(enrollmentId) {
    showToast('Edit enrollment functionality is not implemented yet.', 'info');
}

// Confirm delete enrollment
function confirmDeleteEnrollment(enrollmentId, studentName) {
    var deleteModal = new bootstrap.Modal(document.getElementById('deleteEnrollmentModal'));
    deleteModal.show();
    
    $('#confirmDeleteEnrollment').off('click').on('click', function() {
        deleteModal.hide();
        showToast('Delete enrollment functionality is not implemented yet.', 'info');
    });
}

// Initialize enrollment DataTable when document is ready
$(document).ready(function() {
    {% if can_view_enrollments %}
    initializeEnrollmentDataTable();
    {% else %}
    // If user can't view enrollments, show a message
    $('#enrollments-table').closest('.card-body').html(`
        <div class="text-center py-4">
            <i class="fas fa-ban fa-3x text-muted mb-3"></i>
            <p class="text-muted">You don't have permission to view enrollments for this course.</p>
        </div>
    `);
    {% endif %}
});
</script>
{% endblock %}