{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container-fluid">
    <div class="card border-dark">
        <div class="card-header bg-primary text-white border-dark">
            <h5 class="card-title mb-0">
                <i class="fas {% if form.instance.pk %}fa-edit{% else %}fa-plus-circle{% endif %} me-2"></i>{{ page_title }}
            </h5>
        </div>
        <div class="card-body">
            <form method="post" enctype="multipart/form-data" id="faq-form">
                {% csrf_token %}
                
                {% if form.non_field_errors %}
                <div class="alert alert-danger">
                    {% for error in form.non_field_errors %}
                        {{ error }}
                    {% endfor %}
                </div>
                {% endif %}
                
                <div class="row">
                    <div class="col-md-8">
                        <!-- Question Field -->
                        <div class="mb-3">
                            <label for="{{ form.question.id_for_label }}" class="form-label">
                                <strong>Question *</strong>
                            </label>
                            {{ form.question }}
                            {% if form.question.errors %}
                                <div class="text-danger small mt-1">
                                    {% for error in form.question.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                            <div class="form-text">Enter the frequently asked question.</div>
                        </div>
                        
                        <!-- Answer Field with Summernote -->
                        <div class="mb-3">
                            <label for="{{ form.answer.id_for_label }}" class="form-label">
                                <strong>Answer *</strong>
                            </label>
                            {{ form.answer }}
                            {% if form.answer.errors %}
                                <div class="text-danger small mt-1">
                                    {% for error in form.answer.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                            <div class="form-text">Provide a detailed answer to the question.</div>
                        </div>
                        
                        <!-- SEO Fields -->
                        <div class="card mb-3">
                            <div class="card-header bg-light">
                                <h6 class="mb-0"><i class="fas fa-search me-2"></i>SEO Settings</h6>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label for="{{ form.meta_title.id_for_label }}" class="form-label">
                                        Meta Title
                                    </label>
                                    {{ form.meta_title }}
                                    {% if form.meta_title.errors %}
                                        <div class="text-danger small mt-1">
                                            {% for error in form.meta_title.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                    <div class="form-text">Optional. If empty, the question will be used.</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="{{ form.meta_description.id_for_label }}" class="form-label">
                                        Meta Description
                                    </label>
                                    {{ form.meta_description }}
                                    {% if form.meta_description.errors %}
                                        <div class="text-danger small mt-1">
                                            {% for error in form.meta_description.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                    <div class="form-text">Optional. If empty, it will be generated from the answer.</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <!-- Sidebar Settings -->
                        <div class="card">
                            <div class="card-header bg-light">
                                <h6 class="mb-0"><i class="fas fa-cog me-2"></i>Settings</h6>
                            </div>
                            <div class="card-body">
                                <!-- Status Field -->
                                <div class="mb-3">
                                    <label for="{{ form.status.id_for_label }}" class="form-label">
                                        <strong>Status</strong>
                                    </label>
                                    {{ form.status }}
                                    {% if form.status.errors %}
                                        <div class="text-danger small mt-1">
                                            {% for error in form.status.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                
                                <!-- Slug Field -->
                                <div class="mb-3">
                                    <label for="{{ form.slug.id_for_label }}" class="form-label">
                                        <strong>Slug</strong>
                                    </label>
                                    {{ form.slug }}
                                    {% if form.slug.errors %}
                                        <div class="text-danger small mt-1">
                                            {% for error in form.slug.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                    <div class="form-text">URL-friendly version of the question. Auto-generated if empty.</div>
                                </div>
                                
                                <!-- Display Order Field -->
                                <div class="mb-3">
                                    <label for="{{ form.display_order.id_for_label }}" class="form-label">
                                        <strong>Display Order</strong>
                                    </label>
                                    {{ form.display_order }}
                                    {% if form.display_order.errors %}
                                        <div class="text-danger small mt-1">
                                            {% for error in form.display_order.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                    <div class="form-text">Lower numbers appear first.</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Action Buttons -->
                        <div class="mt-3">
                            <button type="submit" class="btn btn-success w-100 mb-2">
                                <i class="fas fa-save me-2"></i>
                                {% if form.instance.pk %}Update FAQ{% else %}Create FAQ{% endif %}
                            </button>
                            <a href="{% url 'faq_app:faq_list' %}" class="btn btn-secondary w-100">
                                <i class="fas fa-times me-2"></i>Cancel
                            </a>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<!-- Summernote CSS -->
<link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-bs4.min.css" rel="stylesheet">
<style>
.note-editor.note-frame {
    border: 1px solid #ced4da !important;
    border-radius: 0.375rem !important;
}

.note-editor.note-frame .note-toolbar {
    background-color: #f8f9fa !important;
    border-bottom: 1px solid #ced4da !important;
}

.form-control:focus {
    border-color: #86b7fe;
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
}
</style>
{% endblock %}

{% block extra_js %}
<!-- Summernote JS -->
<script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-bs4.min.js"></script>

<script>
$(document).ready(function() {
    // Initialize Summernote
    $('#summernote').summernote({
        height: 300,
        toolbar: [
            ['style', ['style']],
            ['font', ['bold', 'italic', 'underline', 'clear']],
            ['fontname', ['fontname']],
            ['color', ['color']],
            ['para', ['ul', 'ol', 'paragraph']],
            ['table', ['table']],
            ['insert', ['link', 'picture', 'video']],
            ['view', ['fullscreen', 'codeview', 'help']]
        ],
        fontNames: ['Arial', 'Arial Black', 'Comic Sans MS', 'Courier New', 'Helvetica', 'Impact', 'Tahoma', 'Times New Roman', 'Verdana'],
        fontSizes: ['8', '9', '10', '11', '12', '14', '18', '24', '36'],
        callbacks: {
            onInit: function() {
                console.log('Summernote is launched');
            },
            onChange: function(contents, $editable) {
                console.log('Content changed:', contents);
            }
        }
    });
    
    // Auto-generate slug from question
    $('#id_question').on('blur', function() {
        if (!$('#id_slug').val()) {
            var question = $(this).val();
            if (question) {
                // Simple slug generation
                var slug = question.toLowerCase()
                    .replace(/[^\w ]+/g, '')
                    .replace(/ +/g, '-');
                $('#id_slug').val(slug);
            }
        }
    });
    
    // Form validation
    $('#faq-form').on('submit', function(e) {
        var question = $('#id_question').val().trim();
        var answer = $('#summernote').summernote('code').trim();
        
        if (!question) {
            e.preventDefault();
            Swal.fire({
                icon: 'error',
                title: 'Validation Error',
                text: 'Please enter a question.'
            });
            return false;
        }
        
        if (!answer || answer === '<p><br></p>') {
            e.preventDefault();
            Swal.fire({
                icon: 'error',
                title: 'Validation Error',
                text: 'Please enter an answer.'
            });
            return false;
        }
    });
});
</script>
{% endblock %}